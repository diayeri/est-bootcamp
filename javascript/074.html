<!DOCTYPE html>
<html lang="ko-KR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>promise, XHR</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.26.0/prism.min.js"></script>
    <style></style>
  </head>
  <body>
    <main>
      <h1>promise, XHR</h1>
      <pre><code class="language-javascript">
// #################################
// # 프로미스 사용 예제
// 새로운 프로미스 객체를 생성
// resolve는 작업이 성공했을 때 호출되고, reject는 작업이 실패했을 때 호출
const promise1 = new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve("성공");
  }, 1000); // 1초 후에 resolve를 호출하여 프로미스를 성공 상태로 만듭니다.
});
const promise2 = new Promise((resolve, reject) => {
  setTimeout(() => {
    reject("실패");
  }, 1000); // 1초 후에 reject를 호출하여 프로미스를 실패 상태로 만듭니다.
});
console.log(promise1);
console.log(promise2);
// promise 객체를 콘솔에 출력. 이 시점에서는 아직 Pending 상태

// #################################
// # XHR과 프로미스 같이 사용하기
// 1. 프로미스 객체 생성
const orderCoffee = new Promise((resolve, reject) => {
  // 2. XHR 요청 생성
  const requestObj = new XMLHttpRequest(); // 새로운 XHR 객체를 생성
  requestObj.open("GET", "notFoundorderCoffee.txt"); // 비동기 GET 요청을 초기화
  requestObj.onreadystatechange = () => {
    // readyState가 변화할 때마다 호출되는 이벤트 리스너를 설정
    if (requestObj.readyState === 4) {
      // 요청이 완료되었을 때 (readyState === 4) 내부의 조건을 확인
      if (requestObj.status === 200) {
        // 요청이 성공했을 때 (status === 200) resolve를 호출
        const result = requestObj.responseText;
        resolve(result);
      } else {
        // 요청이 실패했을 때 reject를 호출
        reject(
          new Error(
            `커피주문이 정상적으로 이뤄지지 않았습니다.: ${requestObj.status}`
          )
        );
      }
    }
  };
  requestObj.send();
});

orderCoffee // then과 catch 메서드를 사용하여 프로미스의 결과를 처리
  .then((asyncResult) => {
    // 프로미스가 성공했을 때 실행되는 콜백을 등록
    console.log(asyncResult);
    console.log("약속이 이루어졌습니다.");
    return asyncResult;
  })
  .catch((error) => {
    // 프로미스가 실패했을 때 실행되는 콜백을 등록
    console.log(error);
  });

// #################################
// # 기본 XHR 요청
let result;
function xhrRequest() {
  const requestObj = new XMLHttpRequest(); // 1. 새로운 XHR 객체 생성
  requestObj.open("GET", "hello.txt"); // 2. 비동기 GET 요청 초기화
  // 3. 상태 변화 감지
  requestObj.onreadystatechange = () => {
    // readyState가 변화할 때마다 호출되는 이벤트 리스너를 설정
    // 요청이 완료되었고 (readyState === 4), 성공했을 때 (status === 200)
    if (requestObj.readyState === 4 && requestObj.status === 200) {
      // 응답 텍스트를 result에 저장하고 document.write(result)로 출력
      result = requestObj.responseText;
      document.write(result);
    }
    // result를 콘솔에 출력
    console.log(result);
  };
  // 서버로 요청 전송
  requestObj.send();
}

xhrRequest();
      </code></pre>
    </main>
    <script src="../common.js"></script>
    <script>
      // #################################
      // # 프로미스 사용 예제
      // 새로운 프로미스 객체를 생성
      // resolve는 작업이 성공했을 때 호출되고, reject는 작업이 실패했을 때 호출
      const promise1 = new Promise((resolve, reject) => {
        setTimeout(() => {
          resolve("성공");
        }, 1000); // 1초 후에 resolve를 호출하여 프로미스를 성공 상태로 만듭니다.
      });
      const promise2 = new Promise((resolve, reject) => {
        setTimeout(() => {
          reject("실패");
        }, 1000); // 1초 후에 reject를 호출하여 프로미스를 실패 상태로 만듭니다.
      });
      console.log(promise1);
      console.log(promise2);
      // promise 객체를 콘솔에 출력. 이 시점에서는 아직 Pending 상태

      // #################################
      // # XHR과 프로미스 같이 사용하기
      // 1. 프로미스 객체 생성
      const orderCoffee = new Promise((resolve, reject) => {
        // 2. XHR 요청 생성
        const requestObj = new XMLHttpRequest(); // 새로운 XHR 객체를 생성
        requestObj.open("GET", "notFoundorderCoffee.txt"); // 비동기 GET 요청을 초기화
        requestObj.onreadystatechange = () => {
          // readyState가 변화할 때마다 호출되는 이벤트 리스너를 설정
          if (requestObj.readyState === 4) {
            // 요청이 완료되었을 때 (readyState === 4) 내부의 조건을 확인
            if (requestObj.status === 200) {
              // 요청이 성공했을 때 (status === 200) resolve를 호출
              const result = requestObj.responseText;
              resolve(result);
            } else {
              // 요청이 실패했을 때 reject를 호출
              reject(
                new Error(
                  `커피주문이 정상적으로 이뤄지지 않았습니다.: ${requestObj.status}`
                )
              );
            }
          }
        };
        requestObj.send();
      });

      orderCoffee // then과 catch 메서드를 사용하여 프로미스의 결과를 처리
        .then((asyncResult) => {
          // 프로미스가 성공했을 때 실행되는 콜백을 등록
          console.log(asyncResult);
          console.log("약속이 이루어졌습니다.");
          return asyncResult;
        })
        .catch((error) => {
          // 프로미스가 실패했을 때 실행되는 콜백을 등록
          console.log(error);
        });

      // #################################
      // # 기본 XHR 요청
      let result;
      function xhrRequest() {
        const requestObj = new XMLHttpRequest(); // 1. 새로운 XHR 객체 생성
        requestObj.open("GET", "hello.txt"); // 2. 비동기 GET 요청 초기화
        // 3. 상태 변화 감지
        requestObj.onreadystatechange = () => {
          // readyState가 변화할 때마다 호출되는 이벤트 리스너를 설정
          // 요청이 완료되었고 (readyState === 4), 성공했을 때 (status === 200)
          if (requestObj.readyState === 4 && requestObj.status === 200) {
            // 응답 텍스트를 result에 저장하고 document.write(result)로 출력
            result = requestObj.responseText;
            document.write(result);
          }
          // result를 콘솔에 출력
          console.log(result);
        };
        // 서버로 요청 전송
        requestObj.send();
      }

      xhrRequest();
    </script>
  </body>
</html>
